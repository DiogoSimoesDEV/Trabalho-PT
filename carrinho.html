<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - TechStore</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html"><h1>üõçÔ∏è TechStore</h1></a>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">In√≠cio</a>
                    <a href="produtos.html" class="nav-link">Produtos</a>
                    <a href="sobre.html" class="nav-link">Sobre N√≥s</a>
                    <a href="contato.html" class="nav-link">Contacto</a>
                </nav>
                <div class="header-actions">
                    <a href="carrinho.html" class="cart-btn active">
                        üõí Carrinho (<span id="cartCount">0</span>)
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Carrinho Section -->
    <section class="carrinho-page">
        <div class="container">
            <h2 class="section-title">Carrinho de Compras</h2>
            <div class="carrinho-content">
                <div class="carrinho-items" id="carrinhoItems">
                    <!-- Itens do carrinho ser√£o inseridos via JavaScript -->
                </div>
                <div class="carrinho-resumo">
                    <h3>Resumo do Pedido</h3>
                    <div class="resumo-item">
                        <span>Subtotal:</span>
                        <span id="subtotal">0,00 ‚Ç¨</span>
                    </div>
                    <div class="resumo-item">
                        <span>Portes:</span>
                        <span id="portes">0,00 ‚Ç¨</span>
                    </div>
                    <div class="resumo-total">
                        <span>Total:</span>
                        <span id="totalCarrinho">0,00 ‚Ç¨</span>
                    </div>
                    <button class="btn btn-primary btn-block" id="checkoutBtn" style="margin-top: 1.5rem;">
                        Finalizar Compra
                    </button>
                    <a href="produtos.html" class="btn btn-secondary btn-block" style="margin-top: 1rem; text-align: center; text-decoration: none;">
                        Continuar a Comprar
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 TechStore. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Modal de Checkout -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content checkout-modal">
            <div class="modal-header">
                <h2>üí≥ Finalizar Compra</h2>
                <button class="close-btn" id="closeCheckout">&times;</button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm">
                    <!-- Resumo do Pedido -->
                    <div class="checkout-summary">
                        <h3>üì¶ Resumo do Pedido</h3>
                        <div class="summary-content">
                            <div class="summary-item">
                                <span>Subtotal:</span>
                                <span id="checkoutSubtotal">0,00 ‚Ç¨</span>
                            </div>
                            <div class="summary-item">
                                <span>Portes:</span>
                                <span id="checkoutPortes">0,00 ‚Ç¨</span>
                            </div>
                            <div class="summary-total">
                                <span>Total a Pagar:</span>
                                <span id="checkoutTotal">0,00 ‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dados de Entrega -->
                    <div class="checkout-section">
                        <h3 class="section-title">
                            <span class="section-icon">üìç</span>
                            Dados de Entrega
                        </h3>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="nome">Nome Completo *</label>
                                <input type="text" id="nome" name="nome" placeholder="Ex: Jo√£o Silva" required>
                            </div>
                            <div class="form-group">
                                <label for="email">E-mail *</label>
                                <input type="email" id="email" name="email" placeholder="exemplo@email.com" required>
                            </div>
                            <div class="form-group">
                                <label for="telefone">Telem√≥vel *</label>
                                <input type="tel" id="telefone" name="telefone" placeholder="912 345 678" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="morada">Morada *</label>
                                <input type="text" id="morada" name="morada" placeholder="Rua, Avenida, etc." required>
                            </div>
                            <div class="form-group">
                                <label for="numero">N√∫mero *</label>
                                <input type="text" id="numero" name="numero" placeholder="123" required>
                            </div>
                            <div class="form-group">
                                <label for="complemento">Complemento</label>
                                <input type="text" id="complemento" name="complemento" placeholder="Andar, porta, etc.">
                            </div>
                            <div class="form-group">
                                <label for="codigoPostal">C√≥digo Postal *</label>
                                <input type="text" id="codigoPostal" name="codigoPostal" placeholder="1000-001" required>
                            </div>
                            <div class="form-group">
                                <label for="localidade">Localidade *</label>
                                <input type="text" id="localidade" name="localidade" placeholder="Lisboa" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="distrito">Distrito *</label>
                                <input type="text" id="distrito" name="distrito" placeholder="Lisboa" required>
                            </div>
                        </div>
                    </div>

                    <!-- M√©todo de Pagamento -->
                    <div class="checkout-section">
                        <h3 class="section-title">
                            <span class="section-icon">üí≥</span>
                            M√©todo de Pagamento
                        </h3>
                        <div class="payment-methods">
                            <div class="payment-group">
                                <label class="payment-group-label">üí≥ Cart√µes</label>
                                <div class="payment-options">
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="cartao_credito" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Cart√£o de Cr√©dito</span>
                                            <span class="payment-icon">üí≥</span>
                                        </span>
                                    </label>
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="cartao_debito" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Cart√£o de D√©bito</span>
                                            <span class="payment-icon">üí≥</span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <div class="payment-group">
                                <label class="payment-group-label">üì± Pagamentos M√≥veis</label>
                                <div class="payment-options">
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="mbway" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">MB Way</span>
                                            <span class="payment-icon">üì±</span>
                                        </span>
                                    </label>
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="apple_pay" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Apple Pay</span>
                                            <span class="payment-icon">üçé</span>
                                        </span>
                                    </label>
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="google_pay" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Google Pay</span>
                                            <span class="payment-icon">üì±</span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <div class="payment-group">
                                <label class="payment-group-label">üè¶ Multibanco</label>
                                <div class="payment-options">
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="multibanco" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Multibanco (ATM)</span>
                                            <span class="payment-icon">üèß</span>
                                        </span>
                                    </label>
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="referencia_multibanco" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Refer√™ncia Multibanco</span>
                                            <span class="payment-icon">üìÑ</span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <div class="payment-group">
                                <label class="payment-group-label">üåê Pagamentos Online</label>
                                <div class="payment-options">
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="paypal" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">PayPal</span>
                                            <span class="payment-icon">üåê</span>
                                        </span>
                                    </label>
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="klarna" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Klarna (Pagar em 3x)</span>
                                            <span class="payment-icon">üí≥</span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                            <div class="payment-group">
                                <label class="payment-group-label">üèõÔ∏è Transfer√™ncias</label>
                                <div class="payment-options">
                                    <label class="payment-option">
                                        <input type="radio" name="pagamento" value="transferencia_bancaria" required>
                                        <span class="payment-option-content">
                                            <span class="payment-name">Transfer√™ncia Banc√°ria</span>
                                            <span class="payment-icon">üèõÔ∏è</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Campos Din√¢micos de Pagamento -->
                        <div id="paymentFields" class="payment-fields" style="display: none;">
                            <h4 class="payment-fields-title">Informa√ß√µes de Pagamento</h4>
                            
                            <!-- Cart√£o de Cr√©dito/D√©bito -->
                            <div id="fields-cartao_credito" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="nomeCartao">Nome no Cart√£o *</label>
                                        <input type="text" id="nomeCartao" name="nomeCartao" placeholder="Ex: JO√ÉO SILVA" maxlength="50">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="numeroCartao">N√∫mero do Cart√£o *</label>
                                        <input type="text" id="numeroCartao" name="numeroCartao" placeholder="0000 0000 0000 0000" maxlength="19" pattern="[0-9\s]{13,19}">
                                    </div>
                                    <div class="form-group">
                                        <label for="validadeCartao">Validade *</label>
                                        <input type="text" id="validadeCartao" name="validadeCartao" placeholder="MM/AA" maxlength="5" pattern="[0-9]{2}/[0-9]{2}">
                                    </div>
                                    <div class="form-group">
                                        <label for="cvvCartao">CVV *</label>
                                        <input type="text" id="cvvCartao" name="cvvCartao" placeholder="123" maxlength="4" pattern="[0-9]{3,4}">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <small>üîí Os seus dados est√£o protegidos com encripta√ß√£o SSL</small>
                                </div>
                            </div>

                            <div id="fields-cartao_debito" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="nomeCartaoDebito">Nome no Cart√£o *</label>
                                        <input type="text" id="nomeCartaoDebito" name="nomeCartaoDebito" placeholder="Ex: JO√ÉO SILVA" maxlength="50">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="numeroCartaoDebito">N√∫mero do Cart√£o *</label>
                                        <input type="text" id="numeroCartaoDebito" name="numeroCartaoDebito" placeholder="0000 0000 0000 0000" maxlength="19" pattern="[0-9\s]{13,19}">
                                    </div>
                                    <div class="form-group">
                                        <label for="validadeCartaoDebito">Validade *</label>
                                        <input type="text" id="validadeCartaoDebito" name="validadeCartaoDebito" placeholder="MM/AA" maxlength="5" pattern="[0-9]{2}/[0-9]{2}">
                                    </div>
                                    <div class="form-group">
                                        <label for="cvvCartaoDebito">CVV *</label>
                                        <input type="text" id="cvvCartaoDebito" name="cvvCartaoDebito" placeholder="123" maxlength="4" pattern="[0-9]{3,4}">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <small>üîí Os seus dados est√£o protegidos com encripta√ß√£o SSL</small>
                                </div>
                            </div>

                            <!-- MB Way -->
                            <div id="fields-mbway" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="mbwayTelefone">N√∫mero de Telem√≥vel MB Way *</label>
                                        <input type="tel" id="mbwayTelefone" name="mbwayTelefone" placeholder="912 345 678" pattern="[0-9]{9}">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <small>üì± Receber√° uma notifica√ß√£o no seu telem√≥vel para confirmar o pagamento</small>
                                </div>
                            </div>

                            <!-- Apple Pay / Google Pay -->
                            <div id="fields-apple_pay" class="payment-field-group" style="display: none;">
                                <div class="payment-info">
                                    <p>Ser√° redirecionado para o Apple Pay para completar o pagamento de forma segura.</p>
                                </div>
                            </div>

                            <div id="fields-google_pay" class="payment-field-group" style="display: none;">
                                <div class="payment-info">
                                    <p>Ser√° redirecionado para o Google Pay para completar o pagamento de forma segura.</p>
                                </div>
                            </div>

                            <!-- Multibanco -->
                            <div id="fields-multibanco" class="payment-field-group" style="display: none;">
                                <div class="payment-info">
                                    <p>Ap√≥s confirmar o pedido, receber√° uma refer√™ncia Multibanco para pagar num terminal ATM ou homebanking.</p>
                                </div>
                            </div>

                            <div id="fields-referencia_multibanco" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="referenciaMultibanco">J√° tem a Refer√™ncia Multibanco?</label>
                                        <input type="text" id="referenciaMultibanco" name="referenciaMultibanco" placeholder="Opcional - Deixe em branco se ainda n√£o tiver">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <p>Receber√° a refer√™ncia Multibanco por e-mail ap√≥s confirmar o pedido.</p>
                                </div>
                            </div>

                            <!-- PayPal -->
                            <div id="fields-paypal" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="paypalEmail">E-mail do PayPal *</label>
                                        <input type="email" id="paypalEmail" name="paypalEmail" placeholder="seu-email@exemplo.com">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <p>Ser√° redirecionado para o PayPal para completar o pagamento de forma segura.</p>
                                </div>
                            </div>

                            <!-- Klarna -->
                            <div id="fields-klarna" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="klarnaEmail">E-mail *</label>
                                        <input type="email" id="klarnaEmail" name="klarnaEmail" placeholder="seu-email@exemplo.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="klarnaTelefone">Telem√≥vel *</label>
                                        <input type="tel" id="klarnaTelefone" name="klarnaTelefone" placeholder="912 345 678">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <p>üí≥ Pague em 3 presta√ß√µes sem juros. Ser√° redirecionado para o Klarna para completar o pagamento.</p>
                                </div>
                            </div>

                            <!-- Transfer√™ncia Banc√°ria -->
                            <div id="fields-transferencia_bancaria" class="payment-field-group" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="iban">IBAN *</label>
                                        <input type="text" id="iban" name="iban" placeholder="PT50 0000 0000 0000 0000 0000 0" pattern="[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="nomeTitular">Nome do Titular da Conta *</label>
                                        <input type="text" id="nomeTitular" name="nomeTitular" placeholder="Nome completo do titular">
                                    </div>
                                </div>
                                <div class="payment-info">
                                    <p>üìß Receber√° os dados banc√°rios por e-mail para efetuar a transfer√™ncia. O pedido ser√° processado ap√≥s confirma√ß√£o do pagamento.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√£o de Confirma√ß√£o -->
                    <div class="checkout-actions">
                        <button type="submit" class="btn btn-primary btn-block btn-large">
                            <span>‚úÖ Confirmar e Finalizar Pedido</span>
                            <span class="btn-total">Total: <span id="checkoutTotalBtn">0,00 ‚Ç¨</span></span>
                        </button>
                        <p class="checkout-security">
                            üîí Pagamento seguro e protegido
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            atualizarCarrinho();
            renderizarCarrinhoCompleto();
            
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (carrinho.length === 0) {
                    alert('O seu carrinho est√° vazio!');
                    return;
                }
                document.getElementById('checkoutModal').classList.add('active');
                const subtotal = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
                const portes = subtotal >= 50 ? 0 : 5.99;
                const total = subtotal + portes;
                
                // Atualizar todos os elementos de total
                document.getElementById('checkoutSubtotal').textContent = formatarPreco(subtotal);
                document.getElementById('checkoutPortes').textContent = formatarPreco(portes);
                document.getElementById('checkoutTotal').textContent = formatarPreco(total);
                document.getElementById('checkoutTotalBtn').textContent = formatarPreco(total);
            });

            document.getElementById('closeCheckout').addEventListener('click', () => {
                document.getElementById('checkoutModal').classList.remove('active');
                // Limpar sele√ß√£o de pagamento e campos
                document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
                    radio.checked = false;
                });
                updatePaymentFields();
            });

            // Mostrar/esconder campos conforme m√©todo de pagamento selecionado
            function updatePaymentFields() {
                const selectedPayment = document.querySelector('input[name="pagamento"]:checked');
                const paymentFields = document.getElementById('paymentFields');
                const allFieldGroups = document.querySelectorAll('.payment-field-group');
                
                // Esconder todos os grupos de campos e limpar
                allFieldGroups.forEach(group => {
                    group.style.display = 'none';
                    const inputs = group.querySelectorAll('input');
                    inputs.forEach(input => {
                        input.removeAttribute('required');
                        input.value = '';
                    });
                });
                
                // Mostrar campos do m√©todo selecionado
                if (selectedPayment && selectedPayment.value) {
                    const paymentMethod = selectedPayment.value;
                    paymentFields.style.display = 'block';
                    const targetGroup = document.getElementById(`fields-${paymentMethod}`);
                    
                    if (targetGroup) {
                        targetGroup.style.display = 'block';
                        // Adicionar required aos campos necess√°rios
                        const inputs = targetGroup.querySelectorAll('input');
                        inputs.forEach(input => {
                            // Campos opcionais n√£o t√™m required
                            if (input.placeholder && !input.placeholder.includes('Opcional') && 
                                input.placeholder !== 'Opcional - Deixe em branco se ainda n√£o tiver') {
                                input.setAttribute('required', 'required');
                            }
                        });
                    }
                } else {
                    paymentFields.style.display = 'none';
                }
            }

            document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
                radio.addEventListener('change', updatePaymentFields);
            });

            // Formata√ß√£o autom√°tica de campos
            const numeroCartao = document.getElementById('numeroCartao');
            if (numeroCartao) {
                numeroCartao.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\s/g, '');
                    value = value.match(/.{1,4}/g)?.join(' ') || value;
                    e.target.value = value;
                });
            }

            const numeroCartaoDebito = document.getElementById('numeroCartaoDebito');
            if (numeroCartaoDebito) {
                numeroCartaoDebito.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\s/g, '');
                    value = value.match(/.{1,4}/g)?.join(' ') || value;
                    e.target.value = value;
                });
            }

            const validadeCartao = document.getElementById('validadeCartao');
            if (validadeCartao) {
                validadeCartao.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        value = value.substring(0, 2) + '/' + value.substring(2, 4);
                    }
                    e.target.value = value;
                });
            }

            const validadeCartaoDebito = document.getElementById('validadeCartaoDebito');
            if (validadeCartaoDebito) {
                validadeCartaoDebito.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        value = value.substring(0, 2) + '/' + value.substring(2, 4);
                    }
                    e.target.value = value;
                });
            }

            const telefoneInputs = document.querySelectorAll('input[type="tel"]');
            telefoneInputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0) {
                        if (value.length <= 3) {
                            value = value;
                        } else if (value.length <= 6) {
                            value = value.substring(0, 3) + ' ' + value.substring(3);
                        } else {
                            value = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 9);
                        }
                    }
                    e.target.value = value;
                });
            });

            document.getElementById('checkoutForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const dadosCliente = {
                    nome: formData.get('nome'),
                    email: formData.get('email'),
                    telefone: formData.get('telefone'),
                    morada: formData.get('morada'),
                    codigo_postal: formData.get('codigoPostal'),
                    localidade: formData.get('localidade'),
                    distrito: formData.get('distrito')
                };
                
                // Simular finaliza√ß√£o do pedido (sem backend)
                const numeroPedido = Math.floor(Math.random() * 10000) + 1000;
                alert('Pedido realizado com sucesso! Em breve receber√° um e-mail de confirma√ß√£o. N√∫mero do pedido: #' + numeroPedido);
                
                // Limpar carrinho
                carrinho = [];
                salvarCarrinho();
                atualizarCarrinho();
                renderizarCarrinhoCompleto();
                
                // Limpar campos de pagamento
                document.querySelectorAll('.payment-field-group').forEach(group => {
                    group.style.display = 'none';
                });
                document.getElementById('paymentFields').style.display = 'none';
                
                    document.getElementById('checkoutModal').classList.remove('active');
                    document.getElementById('checkoutForm').reset();
            });

            document.getElementById('checkoutModal').addEventListener('click', (e) => {
                if (e.target.id === 'checkoutModal') {
                    document.getElementById('checkoutModal').classList.remove('active');
                    // Limpar sele√ß√£o de pagamento e campos
                    document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
                        radio.checked = false;
                    });
                    updatePaymentFields();
                }
            });
        });

    </script>
</body>
</html>

